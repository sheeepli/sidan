<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>查询结果</title>
    <link rel="stylesheet" href="//unpkg.com/layui@2.6.8/dist/css/layui.css" />
    <link rel="stylesheet" href="./bootstrap/index.css" />
  </head>
  <style>
    .col-form-label {
      text-align: right;
    }
  </style>
  <body style="font-size: 14px">
    <div class="container p-5" style="min-width: 1400px; max-width: 100%">
      <h4 class="text-center mb-5">xxx查询系统</h4>
      <div class="mb-2" style="display: flex; justify-content: space-between">
        <div>
          <button class="btn btn-primary btn-sm" onclick="doEdit(0)">
            添加
          </button>
          <button class="btn btn-primary btn-sm" onclick="onMul()">
            批量添加
          </button>
          <button class="btn btn-danger btn-sm" onclick="onAllDel()">
            全部删除
          </button>
        </div>
        <div>
          <div style="width: 200px; display: flex">
            <div style="margin-right: 4px">
              <input
                type="text"
                class="form-control"
                style="padding: 0.18rem 0.75rem"
                name="key"
                id="key"
                placeholder="搜索"
              />
            </div>
            <button
              class="btn btn-primary btn-sm"
              style="width: 100px"
              onclick="onSearch()"
            >
              搜索
            </button>
          </div>
        </div>
      </div>
      <table class="table table-hover table-striped table-bordered">
        <thead>
          <tr>
            <th scope="col">名称（机构名称|个人参赛）</th>
            <th scope="col">姓名</th>
            <th scope="col">选手号</th>
            <th scope="col">舞种</th>
            <th scope="col">剧目名称</th>
            <th scope="col">作品时长</th>
            <th scope="col">是否原创</th>
            <th scope="col">指导老师</th>
            <th scope="col">赛场</th>
            <th scope="col">抽奖值</th>
            <th scope="col">备注</th>
            <th scope="col" style="width: 130px">操作</th>
          </tr>
        </thead>
        <tbody class="tbody"></tbody>
      </table>
    </div>

    <!-- 添加 -->
    <div
      class="modal fade"
      id="addModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">添加</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form class="row" id="formId">
              <div class="mb-3 row">
                <label for="jgmc" class="col-sm-6 col-form-label"
                  >名称（机构名称|个人参赛）</label
                >
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="jgmc" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="xsxm" class="col-sm-6 col-form-label">姓名</label>
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="xsxm" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="xsbh" class="col-sm-6 col-form-label">选手号</label>
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="xsbh" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="wz" class="col-sm-6 col-form-label">舞种</label>
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="wz" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="jmmc" class="col-sm-6 col-form-label"
                  >剧目名称</label
                >
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="jmmc" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="zpsc" class="col-sm-6 col-form-label"
                  >作品时长</label
                >
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="zpsc" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="sfyc" class="col-sm-6 col-form-label"
                  >是否原创</label
                >
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="sfyc" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="zdls" class="col-sm-6 col-form-label"
                  >指导老师</label
                >
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="zdls" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="sc" class="col-sm-6 col-form-label">赛场</label>
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="sc" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="bz" class="col-sm-6 col-form-label">备注</label>
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="bz" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="cjz" class="col-sm-6 col-form-label">抽奖值</label>
                <div class="col-sm-6">
                  <input class="form-control form-control-add" name="cjz" />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              取消
            </button>
            <button type="button" class="btn btn-primary" onclick="onAdd()">
              确认
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 编辑 -->
    <div
      class="modal fade"
      id="modModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">编辑</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form class="row" id="formId">
              <div class="mb-3 row">
                <label for="jgmc" class="col-sm-6 col-form-label"
                  >名称（机构名称|个人参赛）</label
                >
                <div class="col-sm-6">
                  <input
                    type="text"
                    class="form-control form-control-mod"
                    id="jgmc"
                    name="jgmc"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="xsxm" class="col-sm-6 col-form-label">姓名</label>
                <div class="col-sm-6">
                  <input
                    class="form-control form-control-mod"
                    id="xsxm"
                    name="xsxm"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="xsbh" class="col-sm-6 col-form-label">选手号</label>
                <div class="col-sm-6">
                  <input
                    class="form-control form-control-mod"
                    id="xsbh"
                    name="xsbh"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="wz" class="col-sm-6 col-form-label">舞种</label>
                <div class="col-sm-6">
                  <input
                    class="form-control form-control-mod"
                    id="wz"
                    name="wz"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="jmmc" class="col-sm-6 col-form-label"
                  >剧目名称</label
                >
                <div class="col-sm-6">
                  <input
                    class="form-control form-control-mod"
                    id="jmmc"
                    name="jmmc"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="zpsc" class="col-sm-6 col-form-label"
                  >作品时长</label
                >
                <div class="col-sm-6">
                  <input
                    class="form-control form-control-mod"
                    id="zpsc"
                    name="zpsc"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="sfyc" class="col-sm-6 col-form-label"
                  >是否原创</label
                >
                <div class="col-sm-6">
                  <input
                    class="form-control form-control-mod"
                    id="sfyc"
                    name="sfyc"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="zdls" class="col-sm-6 col-form-label"
                  >指导老师</label
                >
                <div class="col-sm-6">
                  <input
                    class="form-control form-control-mod"
                    id="zdls"
                    name="zdls"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="sc" class="col-sm-6 col-form-label">赛场</label>
                <div class="col-sm-6">
                  <input
                    class="form-control form-control-mod"
                    id="sc"
                    name="sc"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="bz" class="col-sm-6 col-form-label">备注</label>
                <div class="col-sm-6">
                  <input
                    class="form-control form-control-mod"
                    id="bz"
                    name="bz"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="cjz" class="col-sm-6 col-form-label">抽奖值</label>
                <div class="col-sm-6">
                  <input
                    class="form-control form-control-mod"
                    id="cjz"
                    name="cjz"
                  />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              取消
            </button>
            <button type="button" class="btn btn-primary" onclick="onMod()">
              确认
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 批量上传 -->
    <div
      class="modal fade"
      id="fileModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">批量上传</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div
              class="layui-upload-drag"
              id="fileUpload"
              style="display: block"
            >
              <i class="layui-icon"></i>
              <p>点击上传，或将文件拖拽到此处</p>
              <div class="layui-hide" id="uploadDemoView">
                <hr />
                <img src="" alt="上传成功后渲染" style="max-width: 196px" />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              onclick="onUpload()"
            >
              取消
            </button>
            <button type="button" class="btn btn-primary" id="uploadBtn">
              确认
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="//unpkg.com/layui@2.6.8/dist/layui.js"></script>
    <script src="./bootstrap/index.js"></script>
    <script src="./js/config.js"></script>
    <script>
      function renderBody(res) {
        if (res.code !== 1 || !res.msg || res.msg.length == 0) {
          $(".tbody").html(
            '<tr><td colspan="11" style="text-align: center;height: 100px;line-height: 100px">无数据</td></tr>'
          );
        } else {
          const data = res.msg;
          const str = JSON.stringify(data);
          $(".tbody").html(
            `<tr>
              <td>${data.jgmc}</td>
              <td>${data.xsxm}</td>
              <td>${data.xsbh}</td>
              <td>${data.wz}</td>
              <td>${data.jmmc}</td>
              <td>${data.zpsc}</td>
              <td>${data.sfyc}</td>
              <td>${data.zdls}</td>
              <td>${data.sc}</td>
              <td>${data.cjz}</td>
              <td>${data.bz}</td>
              <td>
                <button type="button" class="btn btn-primary btn-sm" onclick='doEdit(1, ${str})'>编辑</button>
                <button class="btn btn-danger btn-sm" onclick="doDel('${data.xsbh}')">删除</button>
              </td>
            </tr>`
          );
        }
      }

      function getData(params) {
        if (params) {
          $.ajax({
            method: "get",
            url: `http://pde.pdedance.cn/2022sort/index.php`,
            data: {
              type: "admin",
              lx: "cha",
              xsbh: params,
            },
            success: (res) => {
              renderBody(res);
            },
          });
        } else {
          return false;
          $.ajax({
            method: "get",
            url: `http://pde.pdedance.cn/2022sort/index.php`,
            data: {
              type: "admin",
              lx: "list",
            },
            success: (res) => {
              renderBody(res);
            },
          });
        }
      }

      function onSearch() {
        getData($("#key").val());
      }

      function onAllDel() {
        layer.confirm(
          "数据宝贵，谨慎删除！",
          { icon: 3, title: "全部删除？" },
          function (index) {
            $.ajax({
              url: `http://pde.pdedance.cn/2022sort/index.php`,
              data: {
                type: "admin",
                lx: "delall",
              },
              method: "get",
              success: (data) => {
                layer.close(index);
                getData($("#key").val());
              },
            });
          }
        );
      }

      function doEdit(editKey, data) {
        if (editKey === 0) {
          $(`.form-control`).val("");
          $("#addModal").modal("show");
        } else {
          Object.keys(data).forEach((item) => {
            $(`#${item}`).val(data[item]);
          });
          $("#modModal").modal("show");
        }
      }

      function doDel( xsbh) {
        $.ajax({
          url: `http://pde.pdedance.cn/2022sort/index.php`,
          data: {
            type: "admin",
            lx: "shan",
            xsbh,
          },
          method: "get",
          success: (data) => {
            getData($("#key").val());
          },
        });
      }

      function onAdd() {
        const values = getParameter($(".form-control-add"));
        $.ajax({
          url: `http://pde.pdedance.cn/2022sort/index.php`,
          data: { type: "admin", lx: "add", ...values },
          method: "post",
          success: (data) => {
            $("#addModal").modal("hide");
            getData($("#key").val());
          },
        });
      }

      function onMod() {
        const values = getParameter($(".form-control-mod"));
        $.ajax({
          url: `http://pde.pdedance.cn/2022sort/index.php`,
          data: { type: "admin", lx: "gai", ...values },
          method: "post",
          success: (data) => {
            $("#modModal").modal("hide");
            getData($("#key").val());
          },
        });
      }

      function onMul() {
        $("#fileModal").modal("show");
      }

      function onUpload() {
        $("#fileModal").modal("hide");
      }

      // $(() => {
      //   getData($("#key").val());
      // });
    </script>

    <script>
      layui.use("upload", function () {
        var upload = layui.upload;
        upload.render({
          elem: "#fileUpload",
          accept: "file",
          exts: "xlsx",
          url: `http://pde.pdedance.cn/2022sort/index.php`,
          auto: false,
          bindAction: "#uploadBtn",
          data: { lx: "upload", type: "admin" },
          error: function (res) {
            return false;
          },
          done: function (res) {
            if (res.code == 1) {
              layer.msg(res.msg);
              $("#fileModal").modal("hide");
              getData($("#key").val());
            } else {
              layer.msg(res.msg);
            }
          },
        });
      });
    </script>
  </body>
</html>
