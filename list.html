<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>查询结果</title>
    <link rel="stylesheet" href="//unpkg.com/layui@2.6.8/dist/css/layui.css" />
    <link rel="stylesheet" href="./bootstrap/index.css" />
  </head>
  <style>
    .col-form-label {
      text-align: right;
    }
  </style>
  <body style="font-size: 14px;">
    <div class="container p-5" style="min-width: 1400px;max-width: 100%;">
      <h4 class="text-center mb-5">xxx查询系统</h4>
      <div class="mb-2">
        <button class="btn btn-primary btn-sm" onclick="doEdit(0)">添加</button>
        <button class="btn btn-primary btn-sm" onclick="onMul()">
          批量添加
        </button>
      </div>
      <table class="table table-hover table-striped table-bordered">
        <thead>
          <tr>
            <th scope="col">选手姓名</th>
            <th scope="col">选手编号</th>
            <th scope="col" style="width: 250px">参赛节目</th>
            <th scope="col">所在组别</th>
            <th scope="col">选送机构</th>
            <th scope="col">所获奖项</th>
            <th scope="col">是否晋级</th>
            <th scope="col">作品完成度分数</th>
            <th scope="col">艺术表现力分数</th>
            <th scope="col">总分</th>
            <th scope="col" style="width: 130px">操作</th>
          </tr>
        </thead>
        <tbody class="tbody"></tbody>
      </table>
      <!-- <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-end"><li class="page-item">  <a class="page-link" href="#" aria-label="Previous">    <span aria-hidden="true">&laquo;</span>  </a></li><li class="page-item"><a class="page-link" href="#">1</a></li><li class="page-item"><a class="page-link" href="#">2</a></li><li class="page-item"><a class="page-link" href="#">3</a></li><li class="page-item">  <a class="page-link" href="#" aria-label="Next">    <span aria-hidden="true">&raquo;</span>  </a></li>
        </ul>
      </nav> -->
    </div>

    <div
      class="modal fade"
      id="addModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">添加</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form class="row" id="formId">
              <div class="mb-3 row">
                <label for="xsxm" class="col-sm-4 col-form-label"
                  >选手姓名</label
                >
                <div class="col-sm-8">
                  <input
                    type="text"
                    class="form-control form-control-add"
                    name="xsxm"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="xsbh" class="col-sm-4 col-form-label"
                  >选手编号</label
                >
                <div class="col-sm-8">
                  <input class="form-control form-control-add" name="xsbh" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="csjm" class="col-sm-4 col-form-label"
                  >参赛节目</label
                >
                <div class="col-sm-8">
                  <input class="form-control form-control-add" name="csjm" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="szzb" class="col-sm-4 col-form-label"
                  >所在组别</label
                >
                <div class="col-sm-8">
                  <input class="form-control form-control-add" name="szzb" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="xsjg" class="col-sm-4 col-form-label"
                  >选送机构</label
                >
                <div class="col-sm-8">
                  <input class="form-control form-control-add" name="xsjg" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="shjx" class="col-sm-4 col-form-label"
                  >所获奖项</label
                >
                <div class="col-sm-8">
                  <input class="form-control form-control-add" name="shjx" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="sfjj" class="col-sm-4 col-form-label"
                  >是否晋级</label
                >
                <div class="col-sm-8">
                  <input class="form-control form-control-add" name="sfjj" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="wcfs" class="col-sm-4 col-form-label"
                  >作品完成度分数</label
                >
                <div class="col-sm-8">
                  <input class="form-control form-control-add" name="wcfs" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="bxfs" class="col-sm-4 col-form-label"
                  >艺术表现力分数</label
                >
                <div class="col-sm-8">
                  <input class="form-control form-control-add" name="bxfs" />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="zfs" class="col-sm-4 col-form-label">总分</label>
                <div class="col-sm-8">
                  <input class="form-control form-control-add" name="zfs" />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              取消
            </button>
            <button type="button" class="btn btn-primary" onclick="onAdd()">
              确认
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="modModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">编辑</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form class="row" id="formId">
              <div class="mb-3 row">
                <label for="xsxm" class="col-sm-4 col-form-label"
                  >选手姓名</label
                >
                <div class="col-sm-8">
                  <input
                    type="text"
                    class="form-control form-control-mod"
                    id="xsxm"
                    name="xsxm"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="xsbh" class="col-sm-4 col-form-label"
                  >选手编号</label
                >
                <div class="col-sm-8">
                  <input
                    class="form-control form-control-mod"
                    id="xsbh"
                    name="xsbh"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="csjm" class="col-sm-4 col-form-label"
                  >参赛节目</label
                >
                <div class="col-sm-8">
                  <input
                    class="form-control form-control-mod"
                    id="csjm"
                    name="csjm"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="szzb" class="col-sm-4 col-form-label"
                  >所在组别</label
                >
                <div class="col-sm-8">
                  <input
                    class="form-control form-control-mod"
                    id="szzb"
                    name="szzb"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="xsjg" class="col-sm-4 col-form-label"
                  >选送机构</label
                >
                <div class="col-sm-8">
                  <input
                    class="form-control form-control-mod"
                    id="xsjg"
                    name="xsjg"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="shjx" class="col-sm-4 col-form-label"
                  >所获奖项</label
                >
                <div class="col-sm-8">
                  <input
                    class="form-control form-control-mod"
                    id="shjx"
                    name="shjx"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="sfjj" class="col-sm-4 col-form-label"
                  >是否晋级</label
                >
                <div class="col-sm-8">
                  <input
                    class="form-control form-control-mod"
                    id="sfjj"
                    name="sfjj"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="wcfs" class="col-sm-4 col-form-label"
                  >作品完成度分数</label
                >
                <div class="col-sm-8">
                  <input
                    class="form-control form-control-mod"
                    id="wcfs"
                    name="wcfs"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="bxfs" class="col-sm-4 col-form-label"
                  >艺术表现力分数</label
                >
                <div class="col-sm-8">
                  <input
                    class="form-control form-control-mod"
                    id="bxfs"
                    name="bxfs"
                  />
                </div>
              </div>
              <div class="mb-3 row">
                <label for="zfs" class="col-sm-4 col-form-label">总分</label>
                <div class="col-sm-8">
                  <input
                    class="form-control form-control-mod"
                    id="zfs"
                    name="zfs"
                  />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              取消
            </button>
            <button type="button" class="btn btn-primary" onclick="onMod()">
              确认
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="fileModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">批量上传</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div
              class="layui-upload-drag"
              id="fileUpload"
              style="display: block"
            >
              <i class="layui-icon"></i>
              <p>点击上传，或将文件拖拽到此处</p>
              <div class="layui-hide" id="uploadDemoView">
                <hr />
                <img src="" alt="上传成功后渲染" style="max-width: 196px" />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              onclick="onUpload()"
            >
              取消
            </button>
            <button type="button" class="btn btn-primary" id="uploadBtn">
              确认
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- http://layui.org.cn/demo/upload.html -->

    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="//unpkg.com/layui@2.6.8/dist/layui.js"></script>
    <script src="./bootstrap/index.js"></script>
    <script src="./js/config.js"></script>
    <script>
      function getData() {
        $.ajax({
          method: "get",
          url: `${serverUrl}/index.php`,
          data: {
            type: "admin",
            lx: "list",
          },
          success: (res) => {
            if (res.code !== 1) {
              $(".tbody").html(
                '<tr><td colspan="10" style="text-align: center;height: 100px;line-height: 100px">无数据</td></tr>'
              );
            } else {
              const data = res.msg;
              $(".tbody").html(
                data.map((item) => {
                  const str = JSON.stringify(item);
                  return `<tr>
                    <td>${item.xsxm}</td>
                    <td>${item.xsbh}</td>
                    <td>${item.csjm}</td>
                    <td>${item.szzb}</td>
                    <td>${item.xsjg}</td>
                    <td>${item.shjx}</td>
                    <td>${item.sfjj}</td>
                    <td>${item.wcfs}</td>
                    <td>${item.bxfs}</td>
                    <td>${item.zfs}</td>
                    <td>
                      <button type="button" class="btn btn-primary btn-sm" onclick='doEdit(1, ${str})'>编辑</button>
                      <button class="btn btn-danger btn-sm" onclick="doDel('${item.xsxm}', '${item.xsbh}')">删除</button>
                    </td>
                  </tr>`;
                })
              );
            }
          },
        });
      }

      function doEdit(editKey, data) {
        if (editKey === 0) {
          $(`.form-control`).val("");
          $("#addModal").modal("show");
        } else {
          Object.keys(data).forEach((item) => {
            $(`#${item}`).val(data[item]);
          });
          $("#modModal").modal("show");
        }
      }

      function doDel(xsxm, xsbh) {
        console.log(xsxm, xsbh)
        $.ajax({
          url: `${serverUrl}/index.php`,
          data: {
            type: "admin",
            lx: "del",
            xsxm,
            xsbh,
          },
          method: "get",
          success: (data) => {
            getData();
          },
        });
      }

      function onAdd() {
        const values = getParameter($(".form-control-add"));
        $.ajax({
          url: `${serverUrl}/index.php`,
          data: { type: "admin", lx: "add", ...values },
          method: "post",
          success: (data) => {
            $("#addModal").modal("hide");
            getData();
          },
        });
      }

      function onMod() {
        const values = getParameter($(".form-control-mod"));
        $.ajax({
          url: `${serverUrl}/index.php`,
          data: { type: "admin", lx: "mod", ...values },
          method: "post",
          success: (data) => {
            $("#modModal").modal("hide");
            getData();
          },
        });
      }
      function onMul() {
        $("#fileModal").modal("show");
      }
      function onUpload() {
        $("#fileModal").modal("hide");
      }
      $(() => {
        getData();
      });
    </script>

    <script>
      layui.use("upload", function () {
        var upload = layui.upload;
        upload.render({
          elem: "#fileUpload",
          accept: "file",
          exts: "xlsx",
          url: `${serverUrl}/index.php`,
          auto: false,
          bindAction: "#uploadBtn",
          data: { lx: "upload", type: "admin" },
          error: function (res) {
            return false;
          },
          done: function (res) {
            if (res.code == 1) {
              layer.msg(res.msg);
              $("#fileModal").modal("hide");
              getData();
            } else {
              layer.msg(res.msg);
            }
          },
        });
      });
    </script>
  </body>
</html>
